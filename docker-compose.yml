release:
  image: mfichman/minecraft:release
  container_name: release
  environment:
  - REDIS_URL=redis://redis:6379
  links:
  - redis
  - postgres

web:
  image: mfichman/minecraft:web
  container_name: web
  restart: always
  environment:
  - RAILS_LOG_TO_STDOUT=true
  - RAILS_MASTER_KEY=${RAILS_MASTER_KEY}
  - REDIS_URL=redis://redis:6379
  - SERVER_NAME=${SERVER_NAME}
  - SSL_PORT=443
  links:
  - redis
  - postgres
  ports:
  - "80:80"
  - "443:443"

worker:
  image: mfichman/minecraft:worker
  container_name: worker
  restart: always
  environment:
  - RAILS_MASTER_KEY=${RAILS_MASTER_KEY}
  - REDIS_URL=redis://redis:6379
  - SERVER_NAME=${SERVER_NAME}
  links:
  - redis
  - postgres
  volumes:
  - /var/run/docker.sock:/var/run/docker.sock
  - /volumes/minecraft:/minecraft/data
  - /volumes/wireguard:/etc/wireguard

logger:
  image: mfichman/minecraft:logger
  container_name: logger
  restart: always
  links:
  - redis
  - postgres
  environment:
  - RAILS_MASTER_KEY=${RAILS_MASTER_KEY}
  - REDIS_URL=redis://redis:6379
  - SERVER_NAME=${SERVER_NAME}
  volumes:
  - /var/run/docker.sock:/var/run/docker.sock

redis:
  image: redis:alpine
  container_name: redis
  restart: always

postgres:
  image: postgres:alpine
  container_name: postgres
  restart: always
  volumes:
  - /volumes/postgres:/var/lib/postgresql/data
  environment:
  - POSTGRES_HOST_AUTH_METHOD=trust

minecraft:
  image: mfichman/minecraft
  container_name: minecraft
  stdin_open: true
  tty: true
  restart: always
  volumes:
  - /volumes/minecraft:/minecraft/data
  ports:
  - "25565:25565"

wireguard:
  image: mfichman/minecraft:wireguard
  container_name: wireguard
  restart: always
  stdin_open: true
  tty: true
  net: host
  privileged: true
  volumes:
  - /volumes/wireguard:/etc/wireguard
  - /lib/modules:/lib/modules
  - /usr/src:/usr/src
